# Crash Overview

A rising multiplier that can crash at any moment. Cash out before it crashes to win; wait too long and lose your wager.

---

## How It Works

- A multiplier starts at 1.00x and rises continuously.
- The crash point is pre-determined at game start using RNG (the player does not know it).
- The player watches the multiplier climb and taps "Cash Out" to lock in the current multiplier.
- If the multiplier reaches the crash point before the player cashes out, the wager is lost.

---

## User Inputs

- **wagerMinutes** (Int, 1 or more, must be less than or equal to remainingMinutes)
- **Auto-cashout multiplier** (optional): if set, the game automatically cashes out when this multiplier is reached (before crash). If not set, the player must manually cash out.

---

## Crash Point Generation

The crash point determines when the round ends. Formula:

- Generate r as a uniform random value in [0, 1).
- crashPoint = max(1.00, floor(0.99 / (1 - r) * 100) / 100)

This produces a distribution where:

- ~1% of rounds crash instantly at 1.00x
- ~50% of rounds crash at or below 2.00x
- ~80% of rounds crash at or below 5.00x
- ~90% of rounds crash at or below 10.00x
- Rare rounds reach 50x, 100x, or higher

House edge: ~1%. For any chosen cashout target m, expected value = 0.99 * wagerMinutes.

---

## Game Resolution

The engine takes two values: crashPoint and cashoutMultiplier.

- **Cash out before crash** (cashoutMultiplier < crashPoint):
  - payout = floor(wagerMinutes * cashoutMultiplier)
  - deltaMinutes = payout - wagerMinutes

- **Crash before cash out** (crashPoint reached):
  - deltaMinutes = -wagerMinutes

- **Auto-cashout**: if the player set an auto-cashout multiplier and crashPoint > autoCashout, then cashoutMultiplier = autoCashout and the player wins.

---

## Multiplier Growth (UI)

The multiplier climbs from 1.00x over time. The growth curve is exponential for visual tension:

- m(t) = e^(speed * t)

The speed constant controls pacing and is a UI-only concern. The engine does not use time; it only compares crashPoint to cashoutMultiplier.

---

## Worked Example

Setup: wagerMinutes = 5, crashPoint = 3.47 (generated by RNG).

**Scenario A: Player cashes out at 2.50x**

- cashoutMultiplier = 2.50
- 2.50 < 3.47, so the player wins.
- payout = floor(5 * 2.50) = floor(12.5) = 12
- deltaMinutes = 12 - 5 = **+7 min**

**Scenario B: Player does not cash out, crash at 3.47x**

- deltaMinutes = -5
- deltaMinutes = **-5 min**

**Scenario C: Floor rounding on small wager**

- wagerMinutes = 1, cashoutMultiplier = 1.80
- payout = floor(1 * 1.80) = floor(1.8) = 1
- deltaMinutes = 1 - 1 = **0 min** (push, no gain)
- To profit on a 1-minute wager, the player must cash out at 2.00x or higher.

---

## Payout Cap

After computing deltaMinutes, the engine clamps the result so that remainingMinutes never exceeds minutes until midnight (23:59). See `spec.md` (Payout cap) for the full rule.

If the raw payout would exceed the cap, deltaMinutes is reduced. The player sees the capped amount.

---

## Edge Cases

- **Instant crash (1.00x):** the round ends immediately, deltaMinutes = -wagerMinutes. No chance to cash out.
- **Cash out at exactly 1.00x:** payout = floor(wager * 1.00) = wager, deltaMinutes = 0 (push).
- **Small wagers and floor rounding:** multipliers between 1.00x and 1.99x yield deltaMinutes = 0 for a 1-minute wager. The wager preview should communicate this.
